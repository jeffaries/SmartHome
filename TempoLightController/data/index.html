<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>My IoT</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://www.urbanui.com/cloudui/dark/vendors/iconfonts/simple-line-icon/css/simple-line-icons.css">
  <link rel="stylesheet" href="http://www.urbanui.com/cloudui/dark/vendors/iconfonts/flag-icon-css/css/flag-icon.min.css">
  <link rel="stylesheet" href="http://www.urbanui.com/cloudui/dark/vendors/css/vendor.bundle.base.css">
  <link rel="stylesheet" href="http://www.urbanui.com/cloudui/dark/vendors/css/vendor.bundle.addons.css">

	<style>
	.switchedOn #switchOff{
		display:none;
	}
	
	.switchedOff #switchOn{
		display:none;
	}

	.boardcard{
		height:200px;
		border:1px solid silver; 
		border-radius:5px; 
		margin-bottom:30px; 
		padding:10px
	}


	</style>
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
        <div class="container">
            <div class="navbar-brand">My IoT</div>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#home" data-toggle="tab">
                            Home
                            <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#configuration" data-toggle="tab">Configuration</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="tabpanel"  style="margin-top:20px">
        <div class="tab-content">
            <div class="tab-pane container active" id="home" role="tabpanel">
			<div id="alertReadMeasures" style="display:none" class=" fade show alert alert-danger" role="alert">
			  Unable to read current values from the sensor.
			</div>
                <div class="row">

					<div class="text-center col-md-6 col-lg-4">
						<div class="boardcard">
							<h5 class="card-title">Light</h5>
							<div style="padding:10px; min-height:135px">						
								<button onclick="toggle()" id="switch" class="btn btn-dark switchedOff" style="width:100px; height:100px;position:absolute;left:50%;margin-left:-50px">
									<svg id="switchOn" xmlns="http://www.w3.org/2000/svg" width="80" height="80" style="position:relative; left:-2px" viewBox="0 0 24 24"><path style="fill:#ffcc00" d="M14 19h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm0 2h-4c-.276 0-.5.224-.5.5s.224.5.5.5h4c.276 0 .5-.224.5-.5s-.224-.5-.5-.5zm.25 2h-4.5l1.188.782c.154.138.38.218.615.218h.895c.234 0 .461-.08.615-.218l1.187-.782zm3.75-13.799c0 3.569-3.214 5.983-3.214 8.799h-5.572c0-2.816-3.214-5.23-3.214-8.799 0-3.723 2.998-5.772 5.997-5.772 3.001 0 6.003 2.051 6.003 5.772zm4-.691v1.372h-2.538c.02-.223.038-.448.038-.681 0-.237-.017-.464-.035-.69h2.535zm-10.648-6.553v-1.957h1.371v1.964c-.242-.022-.484-.035-.726-.035-.215 0-.43.01-.645.028zm-3.743 1.294l-1.04-1.94 1.208-.648 1.037 1.933c-.418.181-.822.401-1.205.655zm10.586 1.735l1.942-1.394.799 1.115-2.054 1.473c-.191-.43-.423-.827-.687-1.194zm-3.01-2.389l1.038-1.934 1.208.648-1.041 1.941c-.382-.254-.786-.473-1.205-.655zm-10.068 3.583l-2.054-1.472.799-1.115 1.942 1.393c-.264.366-.495.763-.687 1.194zm13.707 6.223l2.354.954-.514 1.271-2.425-.982c.21-.397.408-.812.585-1.243zm-13.108 1.155l-2.356 1.06-.562-1.251 2.34-1.052c.173.433.371.845.578 1.243zm-1.178-3.676h-2.538v-1.372h2.535c-.018.226-.035.454-.035.691 0 .233.018.458.038.681z"/></svg>
									<svg id="switchOff" xmlns="http://www.w3.org/2000/svg" width="80" height="80" style="position:relative; left:-2px" viewBox="0 0 24 24"><path style="fill:#cccccc" d="M19 6.734c0 4.164-3.75 6.98-3.75 10.266h-1.992c.001-2.079.997-3.826 1.968-5.513.912-1.585 1.774-3.083 1.774-4.753 0-3.108-2.517-4.734-5.004-4.734-2.483 0-4.996 1.626-4.996 4.734 0 1.67.862 3.168 1.774 4.753.971 1.687 1.966 3.434 1.967 5.513h-1.991c0-3.286-3.75-6.103-3.75-10.266 0-4.343 3.498-6.734 6.996-6.734 3.502 0 7.004 2.394 7.004 6.734zm-4 11.766c0 .276-.224.5-.5.5h-5c-.276 0-.5-.224-.5-.5s.224-.5.5-.5h5c.276 0 .5.224.5.5zm0 2c0 .276-.224.5-.5.5h-5c-.276 0-.5-.224-.5-.5s.224-.5.5-.5h5c.276 0 .5.224.5.5zm-1.701 3.159c-.19.216-.465.341-.753.341h-1.093c-.288 0-.562-.125-.752-.341l-1.451-1.659h5.5l-1.451 1.659z"/></svg>

								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
            <div class="tab-pane container fade" id="configuration" role="tabpanel">
                <div class="tab-content">
                    <form class="form-horizontal" id="myForm">
                        <h1 class="display-4">Configuration</h1>
                        <div />
                        <h5>Light</h5>
                        <div class="form-group row">
                            <label for="light_timeout" class="col-md-3 col-form-label">Light Timeout:</label>
                            <div class="col-md-5  input-group">
                                <input type="number" step="1" class="form-control" name="light_timeout" id="light_timeout" placeholder="Time before automatic switch off" required>
                                <div class="input-group-append">
                                    <span class="input-group-text">Seconds</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="notification_time" class="col-md-3 col-form-label">Notification time:</label>
                            <div class="col-md-5  input-group">
                                <input type="number" step="1" class="form-control" name="notification_time" id="notification_time" placeholder="Blinking led time" required>
                                <div class="input-group-append">
                                    <span class="input-group-text">Seconds</span>
                                </div>
                            </div>
                        </div>						
                        <hr />
                        <h5>MQTT</h5>
                        <div class="form-group row ">
                            <label for="module_name" class="col-md-3 col-form-label">Module Name:</label>
                            <div class="col-md-5">
                                <input type="text" class="form-control" name="module_name" id="module_name" placeholder="Required" required>
                            </div>
                        </div>
                        <div class="form-group row ">
                            <label for="mqtt_server" class="col-md-3 col-form-label">MQTT Server:</label>
                            <div class="col-md-5">
                                <input type="text" class="form-control" name="mqtt_server" id="mqtt_server" placeholder="Required" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="mqtt_port" class="col-md-3 col-form-label">MQTT Port:</label>
							<div class="col-md-5">
								<input type="number" class="form-control" name="mqtt_port" id="mqtt_port" placeholder="Required" required>
                            </div>
                        </div>						
                        <div class="form-group row">
                            <label for="mqtt_prefix" class="col-md-3 col-form-label">MQTT prefix:</label>
                            <div class="col-md-5  input-group">
                                <input type="text" class="form-control" name="mqtt_prefix" id="mqtt_prefix" placeholder="Required" required>
                                <div class="input-group-append">
                                    <span class="input-group-text">/<span id="suffix"></span></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="mqtt_publish_interval" class="col-md-3 col-form-label">Publishing interval:</label>
                            <div class="col-md-5  input-group">
                                <input type="number" class="form-control" name="mqtt_publish_interval" id="mqtt_publish_interval" placeholder="Required" required>
                                <div class="input-group-append">
                                    <span class="input-group-text">seconds</span>
                                </div>
                            </div>
                        </div>
                        <div>&nbsp;</div>
                        <button type="submit" id="submit" class="btn btn-primary right">Submit</button>
                    </form>
                </div>

            </div>
        </div>
    </div>

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <script language="javascript">
        $(function () {

            $("#module_name").change(function () {
                $("#suffix").text($("#module_name").val());
            });


            $.ajax({
                type: "GET",
                url: "/config",
                success: function (data) {
                    $.each(data, function (key, value) {
                        $("#" + key).val(value);
                    });
					$("#suffix").text($("#module_name").val());
                },
				error: function (request, status, error) {
					alert(request.responseText);
				}

            });


            var tid = setInterval(loadData, 1000);
			loadData();


			//twitter bootstrap script
			$(document).on("submit", this.id, function(e) {
				e.preventDefault();
				var frm = e.target.id;
				var frmData = $("#" + frm).serialize();
				$.ajax({
					type: "POST",
					url: "/save",
					data: frmData,
					success: function (msg) {
						alert("Successfully saved");
					},
					error: function (request, status, error) {
						alert(request.responseText);
					}
				});
			});
        });
		
		var state = false;
		function toggle(){
						if(state)
						{
							$("#switch").addClass("btn-dark");
							$("#switch").removeClass("btn-success");
						
							$("#switch").addClass("switchedOff");
							$("#switch").removeClass("switchedOn");
							state = false;
						}
						else
						{
							$("#switch").removeClass("btn-dark");
							$("#switch").addClass("btn-success");
						
							$("#switch").addClass("switchedOn");
							$("#switch").removeClass("switchedOff");
							state = true;
						}
		}

        function loadData() {
            $.ajax({
                type: "GET",
                url: "/data",
                success: function (data) {
					if(data.error)
					{
						$("#alertReadMeasures").show();
					}
					else
					{
						if(data.relaystate)
						{
							$("#bulb").addClass("switchedOn");
						}
						else
						{
							$("#bulb").removeClass("switchedOn");
						}
						$("#alertReadMeasures").hide();
					}
                },
				error: function (request, status, error) {
					//alert(request.responseText);
					$("#alertReadMeasures").show();
				}

            });
        }

    </script>
</body>

</html>
